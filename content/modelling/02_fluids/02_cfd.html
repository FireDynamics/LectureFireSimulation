
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>2.2. Computational Fluid Dynamics &#8212; Fire Simulation &lt;br&gt; Lecture Notes</title>
    
  <link href="../../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../../_static/sphinx-book-theme.acff12b8f9c144ce68a297486a2fa670.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/custom.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
    <script src="../../../_static/jquery.js"></script>
    <script src="../../../_static/underscore.js"></script>
    <script src="../../../_static/doctools.js"></script>
    <script src="../../../_static/togglebutton.js"></script>
    <script src="../../../_static/clipboard.min.js"></script>
    <script src="../../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe"
        const thebe_selector_input = "pre"
        const thebe_selector_output = ".output"
    </script>
    <script async="async" src="../../../_static/sphinx-thebe.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"TeX": {"Macros": {"vv": "\\vec{v}", "vu": "\\vec{u}", "mf": "\\small\\sf", "dQ": "\\dot{Q}", "dq": "\\dot{q}", "dm": "\\dot{m}", "du": "\\dot{u}"}}, "tex2jax": {"inlineMath": [["\\(", "\\)"]], "displayMath": [["\\[", "\\]"]], "processRefs": false, "processEnvironments": false}})</script>
    <link rel="canonical" href="https://firedynamics.github.io/LectureFireSimulation/content/modelling/02_fluids/02_cfd.html" />
    <link rel="shortcut icon" href="../../../_static/cce_logo_standalone_icon.png"/>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
    <link rel="next" title="2.3. Turbulence" href="03_turbulence.html" />
    <link rel="prev" title="2.1. Fluids" href="01_fluids.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../../index.html">
      
      <img src="../../../_static/cce_logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Fire Simulation <br> Lecture Notes</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview/01_overview.html">
   Overview
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview/02_team.html">
   Team Fire Dynamics
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../overview/03_references.html">
   References
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Modelling
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../01_general/00_overview.html">
   1. Modelling Fires
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_general/01_processes.html">
     1.1. Physical and Chemical Processes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_general/02_fse.html">
     1.2. Fire Safety Engineering
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../01_general/03_approaches.html">
     1.3. Modelling Approaches
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 current active has-children">
  <a class="reference internal" href="00_overview.html">
   2. Fluid Dynamics
  </a>
  <input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul class="current">
   <li class="toctree-l2">
    <a class="reference internal" href="01_fluids.html">
     2.1. Fluids
    </a>
   </li>
   <li class="toctree-l2 current active">
    <a class="current reference internal" href="#">
     2.2. Computational Fluid Dynamics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="03_turbulence.html">
     2.3. Turbulence
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../03_compartments/00_overview.html">
   3. Compartment Fires
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_compartments/01_fundamentals.html">
     3.1. Fundamentals
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_compartments/02_design_fire.html">
     3.2. Design Fires
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_compartments/03_pool_example.html">
     3.3. Example – Pool Fire
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../03_compartments/04_steckler_example.html">
     3.4. Example - Steckler Compartment
    </a>
   </li>
  </ul>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Tools
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tools/01_fds_smv/00_overview.html">
   FDS and SMV
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/01_fds_smv/01_fds_intro.html">
     FDS Overview
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/01_fds_smv/02_fds_tutorial.html">
     FDS Basic Example
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/01_fds_smv/02_smv.html">
     Smokeview Basics
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tools/02_hpc/00_overview.html">
   HPC
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/02_hpc/01_linux.html">
     Linux
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/02_hpc/02_hpc.html">
     High Performace Computing
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/02_hpc/03_parallel_fds.html">
     Parallel Execution of FDS
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/02_hpc/04_benchmarking.html">
     Benchmarking
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../../tools/03_analysis/00_overview.html">
   Data Analysis
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/03_analysis/01_python.html">
     Python
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../../tools/03_analysis/02_fdsreader.html">
     fdsreader Module
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../../_sources/content/modelling/02_fluids/02_cfd.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/FireDynamics/LectureFireSimulation"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/FireDynamics/LectureFireSimulation/issues/new?title=Issue%20on%20page%20%2Fcontent/modelling/02_fluids/02_cfd.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/FireDynamics/LectureFireSimulation/edit/main/book/content/modelling/02_fluids/02_cfd.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/FireDynamics/LectureFireSimulation/main?urlpath=tree/book/content/modelling/02_fluids/02_cfd.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../../../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        <a class="jupyterhub-button" href="https://io.cce.uni-wuppertal.de/firesim_ss21//hub/user-redirect/git-pull?repo=https://github.com/FireDynamics/LectureFireSimulation&urlpath=tree/LectureFireSimulation/book/content/modelling/02_fluids/02_cfd.ipynb&branch=main"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch JupyterHub" data-toggle="tooltip"
                data-placement="left"><img class="jupyterhub-button-logo"
                    src="../../../_static/images/logo_jupyterhub.svg"
                    alt="Interact on JupyterHub">JupyterHub</button></a>
        
        
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#overview">
   Overview
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#approximation-of-derivatives">
   Approximation of Derivatives
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#taylor-series">
     Taylor Series
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#derivatives">
     Derivatives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discretisation">
     Discretisation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#discrete-derivatives">
     Discrete Derivatives
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#approximation-error">
     Approximation Error
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#time-integration">
   Time Integration
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#trajectories">
     Trajectories
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#explicit-euler-method">
     Explicit Euler Method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#implicit-euler-method">
     Implicit Euler Method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#euler-heun-method">
     Euler-Heun Method
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#runge-kutta-method-s">
     Runge-Kutta method(s)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#finite-difference-method">
   Finite Difference Method
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#solution-approach">
     Solution Approach
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#stability">
   Stability
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#information-propagation">
     Information Propagation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#courant-friedrichs-lewy-cfl-condition">
     Courant-Friedrichs-Lewy (CFL) condition
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Set the matplotlib output to svg</span>
<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">set_matplotlib_formats</span>
<span class="n">set_matplotlib_formats</span><span class="p">(</span><span class="s1">&#39;svg&#39;</span><span class="p">)</span>

<span class="kn">import</span> <span class="nn">os</span>
<span class="c1"># check for set environment variable JB_NOSHOW</span>
<span class="n">show</span> <span class="o">=</span> <span class="kc">True</span>
<span class="k">if</span> <span class="s1">&#39;JB_NOSHOW&#39;</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">:</span>
    <span class="n">show</span> <span class="o">=</span> <span class="kc">False</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="computational-fluid-dynamics">
<h1><span class="section-number">2.2. </span>Computational Fluid Dynamics<a class="headerlink" href="#computational-fluid-dynamics" title="Permalink to this headline">¶</a></h1>
<div class="section" id="overview">
<h2>Overview<a class="headerlink" href="#overview" title="Permalink to this headline">¶</a></h2>
<p>The very general approach to numericaly solve a set of coupled PDEs is outlined in <a class="reference internal" href="#fig-cfd-overview"><span class="std std-numref">Fig. 2.11</span></a>. In case of fluid dynamics, these are the equations introduced earlier. The numerical solution of those is called computational fluid dynamics (CFD).</p>
<div class="figure align-default" id="fig-cfd-overview">
<a class="reference internal image-reference" href="../../../_images/numerical_solution_overview.svg"><img alt="../../../_images/numerical_solution_overview.svg" src="../../../_images/numerical_solution_overview.svg" width="100%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.11 </span><span class="caption-text">Overview of the general approach in computational fluid dynamics.</span><a class="headerlink" href="#fig-cfd-overview" title="Permalink to this image">¶</a></p>
</div>
<p>The main aspect in solving PDEs is to approximate the involved derivatives. This approximation is carried out in a discretised domain and leads to a set of algebraic equations, eventually a system of linear equations. There exist multiple approximation approaches with different specialisations and properties, where these three are the most prominent ones:</p>
<ul class="simple">
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Finite_element_method">Finite element method (FEM)</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Finite_volume_method">Finite volume method (FVM)</a></p></li>
<li><p><a class="reference external" href="https://en.wikipedia.org/wiki/Finite_difference_method">Finite difference method (FDM)</a></p></li>
</ul>
<p>As FDS is a FDM based solver, the main focus of this section is on the finite difference method. Yet, there will be also a few selected FVM aspects outlined.</p>
</div>
<div class="section" id="approximation-of-derivatives">
<h2>Approximation of Derivatives<a class="headerlink" href="#approximation-of-derivatives" title="Permalink to this headline">¶</a></h2>
<div class="section" id="taylor-series">
<h3>Taylor Series<a class="headerlink" href="#taylor-series" title="Permalink to this headline">¶</a></h3>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Taylor_series">Taylor series</a> can approximate any <span class="math notranslate nohighlight">\(\mf C^\infty\)</span> function at an expansion point <span class="math notranslate nohighlight">\(\mf x_0\)</span>. The approximation of <span class="math notranslate nohighlight">\(\mf f(x)\)</span> is given in terms of <span class="math notranslate nohighlight">\(\mf h\)</span>, being the coordinate variable in the vicinity of <span class="math notranslate nohighlight">\(\mf x_0\)</span>.</p>
<div class="math notranslate nohighlight" id="equation-eq-taylor-series">
<span class="eqno">(2.11)<a class="headerlink" href="#equation-eq-taylor-series" title="Permalink to this equation">¶</a></span>\[\begin{split}
\begin{align}
\mf f(x_0 + h) &amp;=\mf \sum_{i=0}^{\infty}\frac{1}{i!}\left.\frac{d^if}{dx^i}\right|_{x_0}\cdot h^i \\ 
\mf &amp;=\mf f(x_0) + f'(x_0)\cdot h + \frac{1}{2} f''(x_0)\cdot h^2 + \frac{1}{6}f'''(x_0)\cdot h^3 + \cdots
\end{align}
\end{split}\]</div>
<div class="margin sidebar">
<p class="sidebar-title">Big O notation</p>
<p>The <a class="reference external" href="https://en.wikipedia.org/wiki/Big_O_notation">big O notation</a> <span class="math notranslate nohighlight">\(\mf \mathcal{O}\)</span> indicates the asymptotical behaviour of a function. In the approximation of derivatives, shown in this section, it indicates the functional reduction of the approximation error for <span class="math notranslate nohighlight">\(\mf h \rightarrow 0\)</span>.</p>
</div>
<p>In practice, the expansion is aborted at a given order <span class="math notranslate nohighlight">\(\mf \mathcal{O}(h^n)\)</span>, where <span class="math notranslate nohighlight">\(\mf n\)</span> indicates the number of Taylor terms considered, i.e.</p>
<div class="math notranslate nohighlight" id="equation-eq-taylor-series-n">
<span class="eqno">(2.12)<a class="headerlink" href="#equation-eq-taylor-series-n" title="Permalink to this equation">¶</a></span>\[
\mf f(x_0 + h) =\sum_{i=0}^{n-1}\left(\frac{1}{i!}\left.\frac{d^if}{dx^i}\right|_{x_0}\cdot h^i\right) +  \mathcal{O}(h^n)\quad .
\]</div>
<p>The expansion up to order three <span class="math notranslate nohighlight">\(\mf \mathcal{O}(h^3)\)</span> takes following form</p>
<div class="math notranslate nohighlight" id="equation-eq-taylor-3rd">
<span class="eqno">(2.13)<a class="headerlink" href="#equation-eq-taylor-3rd" title="Permalink to this equation">¶</a></span>\[
\mf f(x_0 + h) = f(x_0) + f'(x_0)\cdot h + \frac{1}{2} f''(x_0)\cdot h^2 + \mathcal{O}(h^3)\quad .
\]</div>
<p><strong>Example of a Taylor expansion</strong></p>
<p>As an example, the approximation of the function</p>
<div class="math notranslate nohighlight" id="equation-eq-cfd-example-fnk">
<span class="eqno">(2.14)<a class="headerlink" href="#equation-eq-cfd-example-fnk" title="Permalink to this equation">¶</a></span>\[
\mf f(x) = \frac{x}{10} + \frac{1}{1+x^2}
\]</div>
<p>at the evaluation point <span class="math notranslate nohighlight">\(\mf x_0 = 2.0\)</span>.</p>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># definition of the example function and its analytical derivatives</span>
<span class="k">def</span> <span class="nf">fnk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">derivative</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="k">return</span> <span class="mf">0.1</span> <span class="o">-</span> <span class="mi">2</span><span class="o">*</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">derivative</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">return</span> <span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">derivative</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">8</span><span class="o">*</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">16</span><span class="o">*</span><span class="n">x</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">-</span> <span class="mi">48</span><span class="o">*</span><span class="n">x</span><span class="o">**</span><span class="mi">3</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">4</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">derivative</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">return</span> <span class="mf">0.1</span><span class="o">*</span><span class="n">x</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">x</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set interval for x</span>
<span class="n">xb</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
<span class="n">xe</span> <span class="o">=</span> <span class="mi">5</span>
<span class="c1"># range of x values</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">f</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

<span class="c1"># evaluation point</span>
<span class="n">x0</span> <span class="o">=</span> <span class="mf">2.0</span>

<span class="c1"># derivative values at x0</span>
<span class="n">f0p0</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">f0p1</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">f0p2</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">f0p3</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="c1"># Taylor series for different orders</span>
<span class="n">ts0</span> <span class="o">=</span>             <span class="n">f0p0</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">0</span>
<span class="n">ts1</span> <span class="o">=</span> <span class="n">ts0</span> <span class="o">+</span>       <span class="n">f0p1</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">1</span>
<span class="n">ts2</span> <span class="o">=</span> <span class="n">ts1</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">2</span> <span class="o">*</span> <span class="n">f0p2</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
<span class="n">ts3</span> <span class="o">=</span> <span class="n">ts2</span> <span class="o">+</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span> <span class="o">*</span> <span class="n">f0p3</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span><span class="o">**</span><span class="mi">3</span>

<span class="c1"># plot generation</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">ylim</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.3</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/taylor_fnk.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts0</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^0)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/taylor_ts0.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^1)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/taylor_ts1.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts2</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^2)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/taylor_ts2.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^3)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/taylor_ts3.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts0</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^0)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts1</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^1)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts2</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^2)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ts3</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\mathcal</span><span class="si">{O}</span><span class="s1">(h^3)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/taylor_all.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_5_0.svg" src="../../../_images/02_cfd_5_0.svg" /><img alt="../../../_images/02_cfd_5_1.svg" src="../../../_images/02_cfd_5_1.svg" /><img alt="../../../_images/02_cfd_5_2.svg" src="../../../_images/02_cfd_5_2.svg" /><img alt="../../../_images/02_cfd_5_3.svg" src="../../../_images/02_cfd_5_3.svg" /><img alt="../../../_images/02_cfd_5_4.svg" src="../../../_images/02_cfd_5_4.svg" /><img alt="../../../_images/02_cfd_5_5.svg" src="../../../_images/02_cfd_5_5.svg" /><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<p>The following figures illustrate the according Taylor approximations for up to <span class="math notranslate nohighlight">\(\mf n=3\)</span>.</p>
<div class="tabbed-set docutils">
<input checked="checked" id="657ecf53-69b9-4426-bee9-6f2af75ebb90" name="a2fb6fc3-ed4c-48a5-889e-5e384b35a679" type="radio">
</input><label class="tabbed-label" for="657ecf53-69b9-4426-bee9-6f2af75ebb90">
f(x)</label><div class="tabbed-content docutils">
<a class="reference internal image-reference" href="../../../_images/taylor_fnk.svg"><img alt="../../../_images/taylor_fnk.svg" src="../../../_images/taylor_fnk.svg" width="90%" /></a>
</div>
<input id="832208ba-f2e2-485a-baa9-1019faa19bed" name="a2fb6fc3-ed4c-48a5-889e-5e384b35a679" type="radio">
</input><label class="tabbed-label" for="832208ba-f2e2-485a-baa9-1019faa19bed">
n=0</label><div class="tabbed-content docutils">
<a class="reference internal image-reference" href="../../../_images/taylor_ts0.svg"><img alt="../../../_images/taylor_ts0.svg" src="../../../_images/taylor_ts0.svg" width="90%" /></a>
</div>
<input id="1fba7de0-7485-47a0-807c-546ef8019c95" name="a2fb6fc3-ed4c-48a5-889e-5e384b35a679" type="radio">
</input><label class="tabbed-label" for="1fba7de0-7485-47a0-807c-546ef8019c95">
n=1</label><div class="tabbed-content docutils">
<a class="reference internal image-reference" href="../../../_images/taylor_ts1.svg"><img alt="../../../_images/taylor_ts1.svg" src="../../../_images/taylor_ts1.svg" width="90%" /></a>
</div>
<input id="5fd50e63-dc24-4f71-9fc8-91cc41717725" name="a2fb6fc3-ed4c-48a5-889e-5e384b35a679" type="radio">
</input><label class="tabbed-label" for="5fd50e63-dc24-4f71-9fc8-91cc41717725">
n=2</label><div class="tabbed-content docutils">
<a class="reference internal image-reference" href="../../../_images/taylor_ts2.svg"><img alt="../../../_images/taylor_ts2.svg" src="../../../_images/taylor_ts2.svg" width="90%" /></a>
</div>
<input id="bba8f353-58a1-4d49-99cd-46c54858c4d1" name="a2fb6fc3-ed4c-48a5-889e-5e384b35a679" type="radio">
</input><label class="tabbed-label" for="bba8f353-58a1-4d49-99cd-46c54858c4d1">
n=3</label><div class="tabbed-content docutils">
<a class="reference internal image-reference" href="../../../_images/taylor_ts3.svg"><img alt="../../../_images/taylor_ts3.svg" src="../../../_images/taylor_ts3.svg" width="90%" /></a>
</div>
<input id="ca9d3682-a924-4ece-b4b7-43a5520f27b8" name="a2fb6fc3-ed4c-48a5-889e-5e384b35a679" type="radio">
</input><label class="tabbed-label" for="ca9d3682-a924-4ece-b4b7-43a5520f27b8">
n in [0,…,3]</label><div class="tabbed-content docutils">
<a class="reference internal image-reference" href="../../../_images/taylor_all.svg"><img alt="../../../_images/taylor_all.svg" src="../../../_images/taylor_all.svg" width="90%" /></a>
</div>
</div>
</div>
<div class="section" id="derivatives">
<h3>Derivatives<a class="headerlink" href="#derivatives" title="Permalink to this headline">¶</a></h3>
<p>To approximate the first derivative of a function <span class="math notranslate nohighlight">\(\mf f(x)\)</span> at <span class="math notranslate nohighlight">\(\mf x=x_0\)</span>, i.e. <span class="math notranslate nohighlight">\(\mf f'(x_0)\)</span>, the Taylor expansion up to <span class="math notranslate nohighlight">\(\mf n=2\)</span> can be used</p>
<div class="math notranslate nohighlight" id="equation-eq-fdm-taylor-n2">
<span class="eqno">(2.15)<a class="headerlink" href="#equation-eq-fdm-taylor-n2" title="Permalink to this equation">¶</a></span>\[
\mf f(x_0 + h) = f(x_0) + f'(x_0)h + \mathcal{O}(h^2)\quad .
\]</div>
<p>After rearrangemet, this results in the forward differentiation of first order</p>
<div class="math notranslate nohighlight" id="equation-eq-fdm-fwd-frst">
<span class="eqno">(2.16)<a class="headerlink" href="#equation-eq-fdm-fwd-frst" title="Permalink to this equation">¶</a></span>\[
\mf f'(x_0) = \frac{f(x_0 + h) - f(x_0)}{h} + \mathcal{O}(h)\quad .
\]</div>
<p>Thus with this formula, it becomes possible to approximate the value of the derivative based on two values of the function, here at <span class="math notranslate nohighlight">\(\mf x_0\)</span> and <span class="math notranslate nohighlight">\(\mf x_0 + h\)</span>.</p>
<p>A graphical representation of equation <a class="reference internal" href="#equation-eq-fdm-fwd-frst">(2.16)</a> is shown below. It demonstrates the formula for <span class="math notranslate nohighlight">\(\mf h=1\)</span>.</p>
<div class="cell tag_hide_input docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># fix value of h</span>
<span class="n">h</span> <span class="o">=</span> <span class="mi">1</span>

<span class="c1"># compute exact tangent function at x0</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">f0p0</span> <span class="o">+</span> <span class="n">f0p1</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># function value at x0+h</span>
<span class="n">f_ph</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x0</span> <span class="o">+</span> <span class="n">h</span><span class="p">)</span>

<span class="c1"># compute difference in function values</span>
<span class="c1"># f0p0 is the function (p0) value at x0 (f0)</span>
<span class="n">df_fwd</span> <span class="o">=</span> <span class="n">f_ph</span> <span class="o">-</span> <span class="n">f0p0</span>

<span class="c1"># compute line at (x0, f0) with approximated slope</span>
<span class="n">fp_fwd</span> <span class="o">=</span> <span class="n">f0p0</span> <span class="o">+</span> <span class="n">df_fwd</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># plot function f(x)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\sf f(x)$&#39;</span><span class="p">)</span>

<span class="c1"># plot tangent of f(x) at x0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>

<span class="c1"># plot line at x0, f(x0) with slope computed by forward difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_fwd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;forward difference $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>

<span class="c1"># indicate function evaluation points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="o">+</span><span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="n">f0p0</span><span class="p">,</span> <span class="n">f_ph</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/derivative_forward.svg&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_9_0.svg" src="../../../_images/02_cfd_9_0.svg" /></div>
</div>
<div class="figure align-default" id="fig-fwd-difference">
<a class="reference internal image-reference" href="../../../_images/derivative_forward.svg"><img alt="../../../_images/derivative_forward.svg" src="../../../_images/derivative_forward.svg" width="90%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.12 </span><span class="caption-text">First order forward difference formula.</span><a class="headerlink" href="#fig-fwd-difference" title="Permalink to this image">¶</a></p>
</div>
<p>While the above formula used the value at <span class="math notranslate nohighlight">\(\mf x_0 + h\)</span> and is thus called a forward differences formula, it is possible to use the function’s value at <span class="math notranslate nohighlight">\(\mf x_0 - h\)</span>. This results in the backward differences formula</p>
<div class="math notranslate nohighlight" id="equation-eq-fdm-backward-frst">
<span class="eqno">(2.17)<a class="headerlink" href="#equation-eq-fdm-backward-frst" title="Permalink to this equation">¶</a></span>\[
\mf f'(x_0) = \frac{f(x_0) - f(x_0 - h)}{h} + \mathcal{O}(h)\quad .
\]</div>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function value at x0-h</span>
<span class="n">f_nh</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x0</span> <span class="o">-</span> <span class="n">h</span><span class="p">)</span>

<span class="c1"># compite difference in function values</span>
<span class="c1"># f0p0 is the function (p0) value at x0 (f0)</span>
<span class="n">df_bck</span> <span class="o">=</span> <span class="n">f0p0</span> <span class="o">-</span> <span class="n">f_nh</span> 

<span class="c1"># compute line at (x0, f0) with approximated slope</span>
<span class="n">fp_bck</span> <span class="o">=</span> <span class="n">f0p0</span> <span class="o">+</span> <span class="n">df_bck</span><span class="o">/</span><span class="n">h</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>

<span class="c1"># plot function f(x)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\sf f(x)$&#39;</span><span class="p">)</span>

<span class="c1"># plot tangent of f(x) at x0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>

<span class="c1"># plot line at x0, f(x0) with slope computed by back difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_bck</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;backward difference $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>

<span class="c1"># indicate function evaluation points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="o">-</span><span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="n">f0p0</span><span class="p">,</span> <span class="n">f_nh</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/derivative_backward.svg&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_12_0.svg" src="../../../_images/02_cfd_12_0.svg" /></div>
</div>
<div class="figure align-default" id="fig-bck-difference">
<a class="reference internal image-reference" href="../../../_images/derivative_backward.svg"><img alt="../../../_images/derivative_backward.svg" src="../../../_images/derivative_backward.svg" width="90%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.13 </span><span class="caption-text">First order backward difference formula.</span><a class="headerlink" href="#fig-bck-difference" title="Permalink to this image">¶</a></p>
</div>
<p>First order approximations are mostly not sufficient and higher order approximations are needed. Using more values of the function, i.e. the combination of multiple Taylor series, higher order formula may be derived, like for the second order central differences formula.</p>
<p>The following two Taylor series are used as starting point</p>
<div class="math notranslate nohighlight" id="equation-eq-fdm-central-start">
<span class="eqno">(2.18)<a class="headerlink" href="#equation-eq-fdm-central-start" title="Permalink to this equation">¶</a></span>\[\begin{split}
\begin{align} 
\mf f(x_0+h) &amp;\mf= f(x_0) + f'(x_0)\cdot h + \frac{1}{2}f''(x_0)\cdot h^2 + \mathcal{O}(h^3) \\ 
\mf f(x_0-h) &amp;\mf= f(x_0) - f'(x_0)\cdot h + \frac{1}{2}f''(x_0)\cdot h^2 + \mathcal{O}(h^3) 
\end{align}
\end{split}\]</div>
<p>Subtracting the first equation from the second</p>
<div class="math notranslate nohighlight" id="equation-eq-fdm-central-intermediate">
<span class="eqno">(2.19)<a class="headerlink" href="#equation-eq-fdm-central-intermediate" title="Permalink to this equation">¶</a></span>\[
\mf f(x_0+h) - f(x_0-h) = 2f'(x_0)\cdot h + \mathcal{O}(h^3)
\]</div>
<p>results in the central difference formula for the first derivative</p>
<div class="math notranslate nohighlight" id="equation-eq-cfd-central-derivative-snd">
<span class="eqno">(2.20)<a class="headerlink" href="#equation-eq-cfd-central-derivative-snd" title="Permalink to this equation">¶</a></span>\[
\mf f'(x_0) = \frac{f(x_0+h) - f(x_0-h)}{2h} + \mathcal{O}(h^2)\quad .
\]</div>
<p>The central differences formula is graphicaly represented in the following figure.</p>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># compite difference in function values</span>
<span class="c1"># f0p0 is the function (p0) value at x0 (f0)</span>
<span class="n">df_cnt</span> <span class="o">=</span> <span class="n">f_ph</span> <span class="o">-</span> <span class="n">f_nh</span>

<span class="c1"># compute line at (x0, f0) with approximated slope</span>
<span class="n">fp_cnt</span> <span class="o">=</span> <span class="n">f0p0</span> <span class="o">+</span> <span class="n">df_cnt</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="p">)</span>
<span class="c1"># compute line at (x0+h, f(x0+h)) with approximated slope for illustration</span>
<span class="n">fp_cnt_tmp</span> <span class="o">=</span> <span class="n">f_ph</span> <span class="o">+</span> <span class="n">df_cnt</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">x0</span><span class="o">-</span><span class="n">h</span><span class="p">)</span>

<span class="c1"># plot function f(x)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\sf f(x)$&#39;</span><span class="p">)</span>

<span class="c1"># plot tangent of f(x) at x0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>

<span class="c1"># plot line at x0, f(x0) with slope computed by central difference</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_cnt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;central difference $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_cnt_tmp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># indicate function evaluation points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x0</span><span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="o">+</span><span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="n">f_nh</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">f_ph</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/derivative_central.svg&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_16_0.svg" src="../../../_images/02_cfd_16_0.svg" /></div>
</div>
<div class="figure align-default" id="fig-cnt-difference">
<a class="reference internal image-reference" href="../../../_images/derivative_central.svg"><img alt="../../../_images/derivative_central.svg" src="../../../_images/derivative_central.svg" width="90%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.14 </span><span class="caption-text">Second order central difference formula.</span><a class="headerlink" href="#fig-cnt-difference" title="Permalink to this image">¶</a></p>
</div>
<p>All three presented methods are shown in a joint illustration in the next figure.</p>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot function f(x)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\sf f(x)$&#39;</span><span class="p">)</span>

<span class="c1"># plot tangent of f(x) at x0</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>

<span class="c1"># lines indicating the slope approximations</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_fwd</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;forward difference $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_bck</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C2&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;backward difference $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_cnt</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;central difference $\sf f&#39;(x_0)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp_cnt_tmp</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C3&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="c1"># indicate function evaluation points</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x0</span><span class="o">-</span><span class="n">h</span><span class="p">,</span> <span class="n">x0</span><span class="p">,</span> <span class="n">x0</span><span class="o">+</span><span class="n">h</span><span class="p">],</span> <span class="p">[</span><span class="n">f_nh</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">f_ph</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span> <span class="n">f0p0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/derivative_all.svg&#39;</span><span class="p">);</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_19_0.svg" src="../../../_images/02_cfd_19_0.svg" /></div>
</div>
<div class="figure align-default" id="fig-all-difference">
<a class="reference internal image-reference" href="../../../_images/derivative_all.svg"><img alt="../../../_images/derivative_all.svg" src="../../../_images/derivative_all.svg" width="90%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.15 </span><span class="caption-text">Comparison of all above presented difference formula.</span><a class="headerlink" href="#fig-all-difference" title="Permalink to this image">¶</a></p>
</div>
<p>It is also possible to derive directional (forward, backwards) formulas second order. The calculus leads to the follwoing formulas</p>
<div class="math notranslate nohighlight" id="equation-eq-cfd-directional-derivative-snd">
<span class="eqno">(2.21)<a class="headerlink" href="#equation-eq-cfd-directional-derivative-snd" title="Permalink to this equation">¶</a></span>\[\begin{split}
\begin{align}
\mf f'(x_0) &amp;\mf= \frac{-3f(x_0) + 4f(x_0+h) - f(x_0+2h)}{2h} + \mathcal{O}(h^2) \\
\mf f'(x_0) &amp;\mf= \frac{ 3f(x_0) - 4f(x_0-h) + f(x_0-2h)}{2h} + \mathcal{O}(h^2) \quad .
\end{align}
\end{split}\]</div>
<div class="admonition-task admonition">
<p class="admonition-title">Task</p>
<p>Derive the discretisation formula for the second derivative</p>
<div class="math notranslate nohighlight" id="equation-eq-cfd-central-sndderivative-snd">
<span class="eqno">(2.22)<a class="headerlink" href="#equation-eq-cfd-central-sndderivative-snd" title="Permalink to this equation">¶</a></span>\[
\mf f''(x_0) = \frac{f(x_0-h) - 2f(x_0) + f(x_0+h)}{h^2} + \mathcal{O}(h^2)
\]</div>
</div>
</div>
<div class="section" id="discretisation">
<h3>Discretisation<a class="headerlink" href="#discretisation" title="Permalink to this headline">¶</a></h3>
<p>In the above section, the derivative of a function was approximated at a single point, here <span class="math notranslate nohighlight">\(\mf x_0\)</span>. In order to compute the derivative of a function in a given interval <span class="math notranslate nohighlight">\(\mf x \in [x_b, x_e]\)</span>, a common approach is to discretise the interval. This means, that it is represented by a finite number of points. Given <span class="math notranslate nohighlight">\(\mf n_x\)</span> as the number of representing points, the interval becomes the following finite set:</p>
<div class="math notranslate nohighlight">
\[
\mf x \in [x_0, \dots, x_i, \dots, x_{n_x-1}]
\]</div>
<p>with</p>
<div class="math notranslate nohighlight">
\[ 
\mf x_0 = x_b; \quad x_{n_x-1} = x_e
\]</div>
<p>If the representing points are equally spaced, then the distance <span class="math notranslate nohighlight">\(\mf \Delta x\)</span> is</p>
<div class="math notranslate nohighlight">
\[
\mf \Delta x = \frac{x_e - x_b}{n_x-1}\quad
\]</div>
<p>and the value of <span class="math notranslate nohighlight">\(\mf x_i\)</span> is given by</p>
<div class="math notranslate nohighlight">
\[
\mf x_i = x_b + i\cdot \Delta x \quad .
\]</div>
<p>In two and three dimensional cases, this discretisation can be represented as a mesh or grid, see <a class="reference internal" href="../01_general/03_approaches.html#fig-field-model"><span class="std std-numref">Fig. 1.19</span></a>. Thus <span class="math notranslate nohighlight">\(\mf \Delta x\)</span> is often called grid spacing.</p>
<p>A common indexing for spatially discretised functions is</p>
<div class="math notranslate nohighlight">
\[
\mf f(x_i) = f_i\quad ,
\]</div>
<p>where the index indicating the position on the spatial mesh is placed as a subscript.</p>
<p>The above definitions and the following examples are for a one-dimensional setup. In general, fire simulations are solved on a three-dimensional domain, with the according quantities for the y- and z-direction, i.e. <span class="math notranslate nohighlight">\(\mf \Delta y, \Delta z\)</span>.</p>
<p><strong>Example of a discretisation:</strong> Given <span class="math notranslate nohighlight">\(\mf n_x = 20\)</span>, the function in equation <a class="reference internal" href="#equation-eq-cfd-example-fnk">(2.14)</a> takes the following discrete representation.</p>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">nx</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xe</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

<span class="n">fi</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;continuous $\sf f(x)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="n">xi</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;discretised $\sf f(x_i)$&#39;</span><span class="p">)</span>
<span class="c1"># plt.vlines( xi, [0] * len(xi), fi, color=&#39;grey&#39;, alpha=0.3)</span>

<span class="c1"># line at y=0</span>
<span class="c1"># plt.axhline(0, color=&#39;black&#39;)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylim</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/discretisation.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_25_0.svg" src="../../../_images/02_cfd_25_0.svg" /><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="fig-cfd-discretisation">
<a class="reference internal image-reference" href="../../../_images/discretisation.svg"><img alt="../../../_images/discretisation.svg" src="../../../_images/discretisation.svg" width="90%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.16 </span><span class="caption-text">One dimensional discretisation.</span><a class="headerlink" href="#fig-cfd-discretisation" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="discrete-derivatives">
<h3>Discrete Derivatives<a class="headerlink" href="#discrete-derivatives" title="Permalink to this headline">¶</a></h3>
<p>Given the approximation formulas and a discretised function, it becomes possible to compute the function’s derivative only with the usage of its values. The approximation formulas are evaluated with <span class="math notranslate nohighlight">\(\mf h = \Delta x\)</span>.</p>
<p>For the function shown above and using the central differences second order <a class="reference internal" href="#equation-eq-cfd-central-derivative-snd">(2.20)</a>, plus the directional derivatives <a class="reference internal" href="#equation-eq-cfd-directional-derivative-snd">(2.21)</a> at the boundaries, the approximated derivative is shown in the following figure.</p>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># function to compute the first derivative with the </span>
<span class="c1"># central differencing scheme</span>
<span class="k">def</span> <span class="nf">central</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
    <span class="n">yp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="c1"># central discretisation scheme</span>
        <span class="n">yp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
       
    <span class="c1"># use of directional derivatives at the boundary</span>
    <span class="n">yp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="mi">3</span><span class="o">*</span><span class="n">y</span><span class="p">[</span> <span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="mi">4</span><span class="o">*</span><span class="n">y</span><span class="p">[</span> <span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">y</span><span class="p">[</span> <span class="mi">2</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span> <span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span> <span class="mi">0</span><span class="p">])</span>
    <span class="n">yp</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span> <span class="mi">3</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="mi">4</span><span class="o">*</span><span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">yp</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># analytical solution of the derivative for comparison</span>
<span class="n">fp</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<span class="c1"># approximation of the derivative</span>
<span class="n">fpi</span> <span class="o">=</span> <span class="n">central</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">fi</span><span class="p">)</span>

<span class="c1"># plot of the function</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">f</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;exact $\sf f(x)$&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="n">xi</span><span class="p">,</span> <span class="n">fi</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;discretised $\sf f(x_i)$&#39;</span><span class="p">)</span>

<span class="c1"># plot of the derivative</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;exact $\sf f&#39;(x)$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span> <span class="n">xi</span><span class="p">,</span> <span class="n">fpi</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C1&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;approximation $\sf f&#39;(x_i)$&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;f(x)&#39;</span><span class="p">)</span>
<span class="c1"># plt.ylim(ylim)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/discrete-derivative.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">();</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_29_0.svg" src="../../../_images/02_cfd_29_0.svg" /><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="fig-cfd-discrete-derivative">
<a class="reference internal image-reference" href="../../../_images/discrete-derivative.svg"><img alt="../../../_images/discrete-derivative.svg" src="../../../_images/discrete-derivative.svg" width="90%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.17 </span><span class="caption-text">Approximation of the first derivative.</span><a class="headerlink" href="#fig-cfd-discrete-derivative" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition-task admonition">
<p class="admonition-title">Task</p>
<p>Create a plot similar to <a class="reference internal" href="#fig-cfd-discrete-derivative"><span class="std std-numref">Fig. 2.17</span></a> for the function</p>
<div class="math notranslate nohighlight">
\[
\mf f(x) = x^4 + 3x^3 + 2 \quad .
\]</div>
<ol class="simple">
<li><p>Discretise the function with <span class="math notranslate nohighlight">\(\mf n_x = 20\)</span> between -2 and 4 and plot the continouos and discrete representation.</p></li>
<li><p>Use this discretasition to approximate the first derivative. Plot the exact and approximated derivative.</p></li>
<li><p>Do the same for the second derivative.</p></li>
</ol>
</div>
</div>
<div class="section" id="approximation-error">
<h3>Approximation Error<a class="headerlink" href="#approximation-error" title="Permalink to this headline">¶</a></h3>
<p>If the exact derivative is known, then the exact deviation of the numerical approximation to the exact values can be computed. A common approach to compute the difference between two data sets is the L2-norm or the root mean square error (RMSE). Given the difference of the function values <span class="math notranslate nohighlight">\(\mf \Delta f\)</span>, here</p>
<div class="math notranslate nohighlight">
\[
\mf \Delta f_i = f'_{numeric,i} - f'_{exact,i}
\]</div>
<p>at the same locations <span class="math notranslate nohighlight">\(\mf x_i\)</span> with <span class="math notranslate nohighlight">\(\mf i \in [0, \dots, n_x-1]\)</span>, the RMSE value is</p>
<div class="math notranslate nohighlight">
\[
\mf RMSE(\Delta f) = \sqrt{\frac{1}{n_x}\sum_{i=0}^{n_x-1}\left(\Delta f_i\right)^2}\quad .
\]</div>
<p>For the example function of the previous section, the approximation error can be computed for various values of <span class="math notranslate nohighlight">\(\mf \Delta x\)</span>, as shown in the following figure. As expected for the second order approximation scheme, the error behaves similar to a quadratic function. However, due to the finite representation of floating point numbers, the convergence stops, when round-off error start to dominate.</p>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dx_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">rmse_list</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">nxe</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">25</span><span class="p">):</span>

    <span class="n">nx</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">nxe</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="p">(</span><span class="n">xe</span> <span class="o">-</span> <span class="n">xb</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">nx</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">xb</span><span class="p">,</span> <span class="n">xe</span><span class="p">,</span> <span class="n">nx</span><span class="p">)</span>

    <span class="n">fi</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">xi</span><span class="p">)</span>
    <span class="n">fpi</span> <span class="o">=</span> <span class="n">central</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">fi</span><span class="p">)</span>
    
    <span class="n">fp</span> <span class="o">=</span> <span class="n">fnk</span><span class="p">(</span><span class="n">xi</span><span class="p">,</span> <span class="n">derivative</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="n">rmse</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">((</span><span class="n">fpi</span> <span class="o">-</span> <span class="n">fp</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="n">nx</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;dx=</span><span class="si">{</span><span class="n">dx</span><span class="si">:</span><span class="s2">4.2e</span><span class="si">}</span><span class="s2"> --&gt; rmse=</span><span class="si">{</span><span class="n">rmse</span><span class="si">:</span><span class="s2">4.2e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    
    <span class="n">dx_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dx</span><span class="p">)</span>
    <span class="n">rmse_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rmse</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>dx=8.57e-01 --&gt; rmse=2.12e-01
dx=4.00e-01 --&gt; rmse=4.72e-02
dx=1.94e-01 --&gt; rmse=1.03e-02
dx=9.52e-02 --&gt; rmse=2.55e-03
dx=4.72e-02 --&gt; rmse=6.33e-04
dx=2.35e-02 --&gt; rmse=1.57e-04
dx=1.17e-02 --&gt; rmse=3.92e-05
dx=5.87e-03 --&gt; rmse=9.80e-06
dx=2.93e-03 --&gt; rmse=2.45e-06
dx=1.47e-03 --&gt; rmse=6.12e-07
dx=7.33e-04 --&gt; rmse=1.53e-07
dx=3.66e-04 --&gt; rmse=3.82e-08
dx=1.83e-04 --&gt; rmse=9.55e-09
dx=9.16e-05 --&gt; rmse=2.39e-09
dx=4.58e-05 --&gt; rmse=5.97e-10
dx=2.29e-05 --&gt; rmse=1.49e-10
dx=1.14e-05 --&gt; rmse=3.74e-11
dx=5.72e-06 --&gt; rmse=1.09e-11
dx=2.86e-06 --&gt; rmse=1.14e-11
dx=1.43e-06 --&gt; rmse=1.99e-11
dx=7.15e-07 --&gt; rmse=4.57e-11
dx=3.58e-07 --&gt; rmse=8.91e-11
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide_cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dx_list</span><span class="p">,</span> <span class="n">rmse_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;None&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;computed&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dx_list</span><span class="p">,</span> <span class="n">rmse_list</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;C0&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>

<span class="n">dx_np</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">dx_list</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="n">dx_list</span><span class="p">,</span> <span class="n">dx_np</span><span class="o">**</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;$\sf \sim\Delta x^2$&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;$\sf\Delta x$&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;$\sf RMSE $&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;./figs/approximation_error.svg&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">show</span><span class="p">:</span> <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">clf</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../../_images/02_cfd_34_0.svg" src="../../../_images/02_cfd_34_0.svg" /><div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;Figure size 432x288 with 0 Axes&gt;
</pre></div>
</div>
</div>
</div>
<div class="figure align-default" id="fig-cfd-approximation-error">
<a class="reference internal image-reference" href="../../../_images/approximation_error.svg"><img alt="../../../_images/approximation_error.svg" src="../../../_images/approximation_error.svg" width="90%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.18 </span><span class="caption-text">Approximation error as a function of the mesh spacing.</span><a class="headerlink" href="#fig-cfd-approximation-error" title="Permalink to this image">¶</a></p>
</div>
<div class="admonition-task admonition">
<p class="admonition-title">Task</p>
<p>Why does the approximation error not reduce further for <span class="math notranslate nohighlight">\(\mf \Delta x \lesssim 5\cdot 10^{-6}\)</span>? Take into account equation <a class="reference internal" href="#equation-eq-cfd-central-derivative-snd">(2.20)</a> and the round off error for 64-bit floating point numbers.</p>
</div>
</div>
</div>
<div class="section" id="time-integration">
<h2>Time Integration<a class="headerlink" href="#time-integration" title="Permalink to this headline">¶</a></h2>
<div class="section" id="trajectories">
<h3>Trajectories<a class="headerlink" href="#trajectories" title="Permalink to this headline">¶</a></h3>
<p>As the PDEs that are considered in fluid dynamics often contain the time as one dimension, time integration is another aspect besides the spatial derivatives.</p>
<p>In a similar fashion as the spatial discretisation, the time dimension is discretised. Thus, the time interval <span class="math notranslate nohighlight">\(\mf [t_b=0, t_e]\)</span> is split into <span class="math notranslate nohighlight">\(\mf n_t\)</span> time steps:</p>
<div class="math notranslate nohighlight">
\[
\mf t_n = n\cdot\Delta t\quad with \quad \Delta t = \frac{t_e}{n_t-1} \quad and \quad n \in [0, n_t-1]\quad .
\]</div>
<p>In order to distinguish the time index from the spatial index, it is placed as a superscript and is not to be mixed with powers:</p>
<div class="math notranslate nohighlight">
\[
\mf u(t_n) = u^n\quad .
\]</div>
<p>Given the time derivative of a function, i.e. the right hand side (rhs),</p>
<div class="math notranslate nohighlight">
\[
\mf \partial_t u = \du = rhs(u, t)
\]</div>
<p>and an initial value for <span class="math notranslate nohighlight">\(\mf u\)</span> at <span class="math notranslate nohighlight">\(\mf t=0\)</span>, the temporal evolution, also called trajectory, needs to be computed. Time integration aims to approximate the next value of the solution <span class="math notranslate nohighlight">\(\mf u^{n+1}\)</span>.</p>
<p>In the following the evaluation point of rhs is shortened to</p>
<div class="math notranslate nohighlight">
\[
\mf rhs(u(t_n), t_n) = rhs^n \quad .
\]</div>
<div class="figure align-default" id="fig-fluid-time-setup">
<a class="reference internal image-reference" href="../../../_images/time_integration_1_setup.svg"><img alt="../../../_images/time_integration_1_setup.svg" src="../../../_images/time_integration_1_setup.svg" width="80%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.19 </span><span class="caption-text">Time Integration.</span><a class="headerlink" href="#fig-fluid-time-setup" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="explicit-euler-method">
<h3>Explicit Euler Method<a class="headerlink" href="#explicit-euler-method" title="Permalink to this headline">¶</a></h3>
<p>Based, again on the Tayor series, a direct approximation of the solution’s next value is based on</p>
<div class="math notranslate nohighlight">
\[
\mf \frac{u^{n+1} - u^n}{\Delta t} = rhs^n + \mathcal{O}(\Delta t)\quad .
\]</div>
<p>It leads directly to</p>
<div class="math notranslate nohighlight" id="equation-eq-cfd-time-forward-euler">
<span class="eqno">(2.23)<a class="headerlink" href="#equation-eq-cfd-time-forward-euler" title="Permalink to this equation">¶</a></span>\[
\mf u^{n+1} = u^n + \Delta t \cdot rhs^n + \mathcal{O}(\Delta t)\quad .
\]</div>
<p>The equation <a class="reference internal" href="#equation-eq-cfd-time-forward-euler">(2.23)</a> is the explicit / forward Euler method. It is graphicaly demonstrated in <a class="reference internal" href="#fig-fluid-time-explicit"><span class="std std-numref">Fig. 2.20</span></a>.</p>
<div class="figure align-default" id="fig-fluid-time-explicit">
<a class="reference internal image-reference" href="../../../_images/time_integration_2_explicit.svg"><img alt="../../../_images/time_integration_2_explicit.svg" src="../../../_images/time_integration_2_explicit.svg" width="80%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.20 </span><span class="caption-text">Time integration – explicit Euler scheme.</span><a class="headerlink" href="#fig-fluid-time-explicit" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="implicit-euler-method">
<h3>Implicit Euler Method<a class="headerlink" href="#implicit-euler-method" title="Permalink to this headline">¶</a></h3>
<p>The evaluation of the derivative in <a class="reference internal" href="#equation-eq-cfd-time-forward-euler">(2.23)</a> at <span class="math notranslate nohighlight">\(\mf t_n\)</span> is just one possibility. In the same mannor as the directional spatial derivatives, the evaluation can be done at <span class="math notranslate nohighlight">\(\mf t_{n+1}\)</span> and leads to the folowing iteration formula:</p>
<div class="math notranslate nohighlight" id="equation-eq-cfd-time-backward-euler">
<span class="eqno">(2.24)<a class="headerlink" href="#equation-eq-cfd-time-backward-euler" title="Permalink to this equation">¶</a></span>\[
\mf u^{n+1} = u^n + \Delta t \cdot rhs^{n+1} + \mathcal{O}(\Delta t)\quad .
\]</div>
<p>The equation <a class="reference internal" href="#equation-eq-cfd-time-backward-euler">(2.24)</a> is the implicit / backward Euler method. It is graphicaly demonstrated in <a class="reference internal" href="#fig-fluid-time-implicit"><span class="std std-numref">Fig. 2.21</span></a>. It is an implicit approach, in contrast to the explcit Euler scheme, which does not allow to directly compute the next iteration step based only on the solution of the current values <span class="math notranslate nohighlight">\(\mf u^n\)</span>. However, as the <span class="math notranslate nohighlight">\(\mf rhs\)</span> can be computed for any value of <span class="math notranslate nohighlight">\(\mf u\)</span>, a matching value of <span class="math notranslate nohighlight">\(\mf u^{n+1}\)</span> can be found to satisfy equation <a class="reference internal" href="#equation-eq-cfd-time-backward-euler">(2.24)</a>.</p>
<div class="figure align-default" id="fig-fluid-time-implicit">
<a class="reference internal image-reference" href="../../../_images/time_integration_3_implicit.svg"><img alt="../../../_images/time_integration_3_implicit.svg" src="../../../_images/time_integration_3_implicit.svg" width="80%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.21 </span><span class="caption-text">Time integration – implicit Euler scheme.</span><a class="headerlink" href="#fig-fluid-time-implicit" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="euler-heun-method">
<h3>Euler-Heun Method<a class="headerlink" href="#euler-heun-method" title="Permalink to this headline">¶</a></h3>
<p>The Euler-Heun method illustrates a second order time integration scheme.</p>
<p>First, an explicit prediciton is done</p>
<div class="math notranslate nohighlight">
\[
\mf u_p^{n+1} = u^n + \Delta t\cdot rhs^n\quad .
\]</div>
<p>This intermediate solution is used for a corrected approximation</p>
<div class="math notranslate nohighlight">
\[
\mf u^{n+1} = u^n + \frac{1}{2} \Delta t\cdot \left(rhs^n + rhs(u_p^{n+1}) \right) + \mathcal{O}(\Delta t^2)\quad .
\]</div>
<div class="figure align-default" id="fig-fluid-time-predictorcorrector">
<a class="reference internal image-reference" href="../../../_images/time_integration_5_predictorcorrector.svg"><img alt="../../../_images/time_integration_5_predictorcorrector.svg" src="../../../_images/time_integration_5_predictorcorrector.svg" width="80%" /></a>
<p class="caption"><span class="caption-number">Fig. 2.22 </span><span class="caption-text">Time integration – Euler-Heun predictor-corrector scheme.</span><a class="headerlink" href="#fig-fluid-time-predictorcorrector" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="runge-kutta-method-s">
<h3>Runge-Kutta method(s)<a class="headerlink" href="#runge-kutta-method-s" title="Permalink to this headline">¶</a></h3>
<p>There exists a wide range of time integration schemes. One class of them are the <a class="reference external" href="https://en.wikipedia.org/wiki/Runge%E2%80%93Kutta_methods">Runge-Kutta methods</a>. The classical scheme is the following fourth order method:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align} 
\mf u^{(1)} &amp;=\mf u^n + \frac{1}{2}\Delta t\cdot rhs^n \\ 
\mf u^{(2)} &amp;=\mf u^n + \frac{1}{2}\Delta t\cdot rhs\left(u^{(1)}\right) \\ 
\mf u^{(3)} &amp;=\mf u^n + \Delta t\cdot rhs\left(u^{(2)}\right) \\ 
\mf u^{n+1} &amp;=\mf u^n + \frac{1}{6}\Delta t\cdot \left(rhs^n + 2\ rhs\left(u^{(1)}\right) + 2\ rhs\left(u^{(2)}\right) + rhs\left(u^{(3)}\right)\right) + \mathcal{O}(\Delta t^4) \quad .
\end{align}
\end{split}\]</div>
</div>
</div>
<div class="section" id="finite-difference-method">
<h2>Finite Difference Method<a class="headerlink" href="#finite-difference-method" title="Permalink to this headline">¶</a></h2>
<div class="section" id="solution-approach">
<h3>Solution Approach<a class="headerlink" href="#solution-approach" title="Permalink to this headline">¶</a></h3>
<p>Consider a simple diffusion equation:</p>
<div class="math notranslate nohighlight">
\[
\mf \partial_t \phi = \lambda\partial_{xx} \phi
\]</div>
<p><strong>Forward Euler:</strong> This scheme can be directly – explicitly – evaluated.</p>
<div class="math notranslate nohighlight">
\[
\mf \frac{\phi^{n+1}_i - \phi^n_i}{\Delta t} = \lambda\frac{\phi^n_{i-1} - 2\phi_i^n + \phi_{i+1}^n}{\Delta x^2}
\]</div>
<div class="math notranslate nohighlight">
\[
\mf \phi^{n+1}_i = \phi^n_i + \Delta t \lambda \frac{\phi^n_{i-1} - 2\phi_i^n + \phi_{i+1}^n}{\Delta x^2}
\]</div>
<div class="figure align-default" id="fig-fdm-explicit-euler">
<a class="reference internal image-reference" href="../../../_images/fdm_explicit_euler.png"><img alt="../../../_images/fdm_explicit_euler.png" src="../../../_images/fdm_explicit_euler.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-number">Fig. 2.23 </span><span class="caption-text">Explicit Euler scheme.</span><a class="headerlink" href="#fig-fdm-explicit-euler" title="Permalink to this image">¶</a></p>
</div>
<p><strong>Backward Euler:</strong> Here a linear equation system must be solved for <span class="math notranslate nohighlight">\(\phi^{n+1}\)</span>.”</p>
<div class="math notranslate nohighlight">
\[
\mf \frac{\phi^{n+1}_i - \phi^n_i}{\Delta t} = \lambda \frac{\phi^{n+1}_{i-1} - 2\phi_i^{n+1} + \phi_{i+1}^{n+1}}{\Delta x^2}
\]</div>
<div class="math notranslate nohighlight">
\[
\mf \phi^{n+1}_i - \frac{\Delta t}{\Delta x^2}\lambda\left( \phi^{n+1}_{i-1} - 2\phi_i^{n+1} + \phi_{i+1}^{n+1} \right) = \phi^n_i
\]</div>
<div class="math notranslate nohighlight">
\[
\mf A\phi^{n+1} = \phi^n
\]</div>
<div class="figure align-default" id="fig-fdm-implicit-euler">
<a class="reference internal image-reference" href="../../../_images/fdm_implicit_euler.png"><img alt="../../../_images/fdm_implicit_euler.png" src="../../../_images/fdm_implicit_euler.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-number">Fig. 2.24 </span><span class="caption-text">Implicit Euler scheme.</span><a class="headerlink" href="#fig-fdm-implicit-euler" title="Permalink to this image">¶</a></p>
</div>
</div>
</div>
<div class="section" id="stability">
<h2>Stability<a class="headerlink" href="#stability" title="Permalink to this headline">¶</a></h2>
<div class="section" id="information-propagation">
<h3>Information Propagation<a class="headerlink" href="#information-propagation" title="Permalink to this headline">¶</a></h3>
<p>An important property of a time integrator is its stability. Given a PDE to be solved and a time integrator, a simple (linear) stability analysis can be conducted, e.g. von Neuman stability analysis. The outcome is the growth factor, which indicates the growth rate of small disturbances. If this factor is larger then 1, then the scheme is unstable, as fluctuations will infinitely rise.</p>
<ul class="simple">
<li><p>Explicit schemes tend to be unstable or conditionally stable, i.e. if a condition for the time step is met</p></li>
<li><p>Implicit schemes tend to be unconditionally stable, however they tend to damp the solution</p></li>
</ul>
<p>A constant velocity advection problem demonstrates the stability condition.</p>
<p><strong>Slow propagation speed</strong></p>
<ul>
<li><p>Model equation</p>
<div class="math notranslate nohighlight">
\[
  \mf \partial_t \phi + \partial_x(v_0\phi) = 0
  \]</div>
</li>
<li><p>Small <span class="math notranslate nohighlight">\(\mf \Delta t\)</span></p></li>
<li><p>Distance traveled per <span class="math notranslate nohighlight">\(\mf \Delta t\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  \mf \delta x = v_0 \Delta t \lt \Delta x
  \]</div>
</li>
<li><p>The information moves less then <span class="math notranslate nohighlight">\(\mf\Delta x\)</span> in a time step <span class="math notranslate nohighlight">\(\mf\Delta t\)</span> and is captured by the neighbouring grid point</p></li>
<li><p>No solution information is lost during time integration</p></li>
</ul>
<div class="figure align-default" id="fig-fdm-cfl-dtsmall">
<a class="reference internal image-reference" href="../../../_images/fdm_cfl_dtsmall.png"><img alt="../../../_images/fdm_cfl_dtsmall.png" src="../../../_images/fdm_cfl_dtsmall.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-number">Fig. 2.25 </span><span class="caption-text">Slow information propagation.</span><a class="headerlink" href="#fig-fdm-cfl-dtsmall" title="Permalink to this image">¶</a></p>
</div>
<p><strong>Fast propagation speed</strong></p>
<ul>
<li><p>Large <span class="math notranslate nohighlight">\(\mf\Delta t\)</span></p></li>
<li><p>Distance traveled per <span class="math notranslate nohighlight">\(\mf\Delta t\)</span>:</p>
<div class="math notranslate nohighlight">
\[
  \mf \delta x = v_0 \Delta t \gt \Delta x
  \]</div>
</li>
<li><p>The information moves more then <span class="math notranslate nohighlight">\(\mf \Delta x\)</span> in a time step <span class="math notranslate nohighlight">\(\mf\Delta t\)</span> and can therefore not be captured anymore</p></li>
<li><p>Information is lost during time integration</p></li>
</ul>
<div class="figure align-default" id="fig-fdm-cfl-dtlarge">
<a class="reference internal image-reference" href="../../../_images/fdm_cfl_dtlarge.png"><img alt="../../../_images/fdm_cfl_dtlarge.png" src="../../../_images/fdm_cfl_dtlarge.png" style="width: 80%;" /></a>
<p class="caption"><span class="caption-number">Fig. 2.26 </span><span class="caption-text">Fast information propagation.</span><a class="headerlink" href="#fig-fdm-cfl-dtlarge" title="Permalink to this image">¶</a></p>
</div>
</div>
<div class="section" id="courant-friedrichs-lewy-cfl-condition">
<h3>Courant-Friedrichs-Lewy (CFL) condition<a class="headerlink" href="#courant-friedrichs-lewy-cfl-condition" title="Permalink to this headline">¶</a></h3>
<p>In general, there exist stability conditions for explicit schemes, which relates the maximal information travel speed <span class="math notranslate nohighlight">\(\mf v_{max}\)</span> and the grid velocity <span class="math notranslate nohighlight">\(\mf v_g = \Delta x / \Delta t\)</span>:</p>
<div class="math notranslate nohighlight">
\[
\mf v_{max} \lt CFL\cdot v_{g}\quad .
\]</div>
<p>Given a mesh resolution <span class="math notranslate nohighlight">\(\mf\Delta x\)</span> and maximal velocities, the above condition limits the time step:</p>
<div class="math notranslate nohighlight">
\[
\mf \Delta t \lt CFL\cdot \frac{\Delta x}{v_{max}}
\]</div>
<p>Notes:</p>
<ul class="simple">
<li><p>The flow velocity may be computed in various ways (<span class="math notranslate nohighlight">\(\mf L_\infty\)</span>, <span class="math notranslate nohighlight">\(L_1\)</span>, <span class="math notranslate nohighlight">\(L_2\)</span> norms), diffusion velocity <span class="math notranslate nohighlight">\(\mf \propto 1/\Delta x\)</span></p></li>
<li><p>There also exist other constrains on <span class="math notranslate nohighlight">\(\mf Delta t\)</span>: mass density constraint and volume constraint.</p></li>
<li><p>The value of the CFL number depends on the time integration scheme.</p></li>
</ul>
<p>Implications of the CFL condition in FDS:</p>
<p>The condition for <span class="math notranslate nohighlight">\(\mf \Delta t\)</span> used in FDS is</p>
<div class="math notranslate nohighlight">
\[
\mf 0.8 \leq CFL = \Delta t \left(\frac{\|\vec{v}\|}{\Delta x} + |\nabla \cdot \vec{v}|\right) \leq 1.0
\]</div>
<ul class="simple">
<li><p>If the CFL number grows above the upper limit, the time step is set to 90% of the allowed, if it falls below the lower limit, then it is increased by 10%.</p></li>
<li><p>In general, the time step is reduced by a factor of 2 when the mesh spacing is reduced by a factor of 2, i.e. the total computational effort increases by a factor of 16.</p></li>
</ul>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./content/modelling/02_fluids"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
        <div class='prev-next-bottom'>
            
    <a class='left-prev' id="prev-link" href="01_fluids.html" title="previous page"><span class="section-number">2.1. </span>Fluids</a>
    <a class='right-next' id="next-link" href="03_turbulence.html" title="next page"><span class="section-number">2.3. </span>Turbulence</a>

        </div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          <div class="extra_footer">
            <p>
<img src='https://mirrors.creativecommons.org/presskit/buttons/88x31/svg/by-sa.svg' height='31'/>
| By Team Fire | Contacts and Infos: <a href='https://cce.uni-wuppertal.de/en.html'>CCE@BUW</a> and <a href='https://www.fz-juelich.de/ias/ias-7/EN/Research/Fire_Dynamics/_node.html'>IAS-7@FZJ</a>
</br>Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</p>

          </div>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>